# 0507



* like 기능 axios로 구현하기 

```
@require_POST
def like(request, review_pk):
    if request.user.is_authenticated:
        review = get_object_or_404(Review, pk=review_pk)
        user = request.user
        
		# ajax 요청에 응답하기 위해 json 형태 데이터 전달하기 위해서
		  `liked`를 통해 상태값을 저장
        if review.like_users.filter(pk=user.pk).exists():
            review.like_users.remove(user)
            liked = False
        else:
            review.like_users.add(user)
            liked = True
            
		# 그리고 context에 dict 형태로 정의해두고, 좋아요 유무 / 좋아요 갯수를 
		  확인할 수 있게 했습니다.
        context = {
            'liked': liked,
            'count': review.like_users.count(),
        }

        return JsonResponse(context)
        
    # 로그인 하지 않았을 때 이전엔 html로 새로고침 했었는데, 
      HttpResponse를 통해 401 code를 리턴했습니다.    
    return HttpResponse(status=401)
```



* html

```
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    const forms = document.querySelectorAll('.like-form')    
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value

    forms.forEach(form => {
      form.addEventListener('submit', function (event) {
        event.preventDefault()
        
        const reviewId = event.target.dataset.reviewId

        axios({
          method: 'post',
          url: `http://127.0.0.1:8000/community/${reviewId}/like/`,
          headers: {'X-CSRFToken': csrftoken},
        })
		.
		.
		.
      
  </script>
{% endblock %}
```

* axios 사용을 위해 CDN추가, form 동작에 이벤트 리스너를 달고, post 요청에 필요한 csrftoken, dataset, pk 정보가 필요한 것 복습

* 무엇보다, like 아이콘이 바뀌는 부분에서 막혔었는데, 버튼 태그와 아이콘태그에 같은 reviewId를 사용해서 문제가 발생했었고, 아이콘 태그에 따로 reviewId 를 설정해둠으로써 해결

  